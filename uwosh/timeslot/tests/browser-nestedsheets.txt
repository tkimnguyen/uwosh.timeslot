Browser tests for uwosh.timeslot
==========================

Let's import some exceptions we'll need to catch later::

    >>> from AccessControl.unauthorized import Unauthorized
    >>> from mechanize._mechanize import LinkNotFoundError
    
To create a signup sheet we need to login in as a manager and create several
different content types.

We start a test browser::

    >>> from Products.Five.testbrowser import Browser
    >>> browser = Browser()
    >>> browser.handleErrors = False
    >>> browser.addHeader('Accept-Language', 'en-US')
    >>> self.portal.error_log._ignored_exceptions = ()

We log in::

    >>> browser.open(portal.absolute_url() + '/login_form')
    >>> browser.getLink('Log in').click()
    >>> browser.getControl(name='__ac_name').value = 'test_user_1_'
    >>> browser.getControl(name='__ac_password').value = 'secret'
    >>> browser.getControl(name='submit').click()
    >>> 'You are now logged in' in browser.contents
    True
    
And make ourselves manager::

    >>> self.setRoles(['Manager'])

Let's create a master signup sheet::

    >>> url = self.portal.absolute_url()
    >>> browser.open(url)
    >>> browser.open(url + '/createObject?type_name=Signup+Sheet')
    >>> browser.getControl(name='title').value = 'Master Signup Sheet'
    >>> browser.getControl(name='form_submit').click()
    >>> 'Changes saved.' in browser.contents
    True
    >>> masterSheet = self.portal['master-signup-sheet']
    >>> masterSheetUrl = masterSheet.absolute_url()

And we'll add inner signup sheets to it:

    >>> browser.open(masterSheetUrl + '/createObject?type_name=Signup+Sheet')
    >>> browser.getControl(name='title').value = 'SheetH'
    >>> browser.getControl(name='form_submit').click()
    >>> 'Changes saved.' in browser.contents
    True
    
    >>> browser.open(masterSheetUrl + '/createObject?type_name=Signup+Sheet')
    >>> browser.getControl(name='title').value = 'SheetZ'
    >>> browser.getControl(name='form_submit').click()
    >>> 'Changes saved.' in browser.contents
    True

    >>> browser.open(masterSheetUrl + '/createObject?type_name=Signup+Sheet')
    >>> browser.getControl(name='title').value = 'SheetA'
    >>> browser.getControl(name='form_submit').click()
    >>> 'Changes saved.' in browser.contents
    True

    >>> browser.open(masterSheetUrl + '/createObject?type_name=Signup+Sheet')
    >>> browser.getControl(name='title').value = 'SheetX'
    >>> browser.getControl(name='form_submit').click()
    >>> 'Changes saved.' in browser.contents
    True

    >>> browser.open(masterSheetUrl + '/createObject?type_name=Signup+Sheet')
    >>> browser.getControl(name='title').value = 'SheetG'
    >>> browser.getControl(name='form_submit').click()
    >>> 'Changes saved.' in browser.contents
    True

Let's make sure all of the sheets get shown in alphabetical order::

    >>> browser.open(masterSheetUrl)
    >>> sheetNames = ['SheetA','SheetG','SheetH','SheetX','SheetZ']
    >>> orderSheetsAppear = map((lambda x: browser.contents.find('<dt class="collapsibleHeader">%s</dt>' % x)), sheetNames)
    >>> orderSheetsAppear == sorted(orderSheetsAppear)
    True

The End.
